{"title":"文件名乱码问题解决","date":"2020-07-20T02:10:00.000Z","date_formatted":{"ll":"2020年7月20日","L":"2020/07/20","MM-DD":"07-20"},"link":"2020/07/20/文件名乱码问题解决","tags":["乱码"],"categories":["工作"],"updated":"2024-10-10T08:03:05.472Z","content":"<p>低版本SpringMvc有个问题可能导致文件名乱码<span id=\"more\"></span>，即FormHttpMessageConverter内部对文件名解析使用US-ASCII且写死</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">byte</span>[] getAsciiBytes(String name) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> name.getBytes(<span class=\"string\">&quot;US-ASCII&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (UnsupportedEncodingException var3) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(var3);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>具体做法:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> MyFormHttpMessageConverter <span class=\"title\">converter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MyFormHttpMessageConverter();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">List&lt;HttpMessageConverter&lt;?&gt;&gt; newList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (HttpMessageConverter&lt;?&gt; httpMessageConverter : list) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(httpMessageConverter <span class=\"keyword\">instanceof</span> FormHttpMessageConverter) &#123;</span><br><span class=\"line\">        newList.add(converter());</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        newList.add(httpMessageConverter);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">restTemplate.setMessageConverters(newList);</span><br></pre></td></tr></table></figure>","prev":{"title":"Spring事件监听机制","link":"2020/09/10/Spring事件监听机制"},"next":{"title":"Java集合相关","link":"2020/06/11/Java集合相关"},"plink":"https://zinki.github.io/2020/07/20/文件名乱码问题解决/"}