{"title":"自定义SQL打印","date":"2018-09-20T09:10:00.000Z","date_formatted":{"ll":"2018年9月20日","L":"2018/09/20","MM-DD":"09-20"},"link":"2018/09/20/自定义SQL打印","tags":["SQL"],"categories":["工作"],"updated":"2024-10-10T08:03:05.476Z","content":"<p>mybatis打印日志格式默认占位符，不方便排查SQL问题<span id=\"more\"></span></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.cache.CacheKey;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.executor.Executor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.BoundSql;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.ParameterMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.ParameterMode;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.plugin.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.RowBounds;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.type.TypeHandlerRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.StringUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Intercepts(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">        @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span></span><br><span class=\"line\"><span class=\"meta\">        @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class, CacheKey.class, BoundSql.class&#125;),</span></span><br><span class=\"line\"><span class=\"meta\">        @Signature(type = Executor.class, method = &quot;update&quot;, args = &#123;MappedStatement.class, Object.class&#125;)&#125;</span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SqlInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">Interceptor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ThreadLocal&lt;SimpleDateFormat&gt; dateTimeFormatter = <span class=\"keyword\">new</span> ThreadLocal&lt;SimpleDateFormat&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> SimpleDateFormat <span class=\"title\">initialValue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">intercept</span><span class=\"params\">(Invocation invocation)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Object result = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//捕获掉异常，不要影响业务</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[<span class=\"number\">0</span>];</span><br><span class=\"line\">            Object parameter = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (invocation.getArgs().length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                parameter = invocation.getArgs()[<span class=\"number\">1</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            String sqlId = mappedStatement.getId();</span><br><span class=\"line\">            BoundSql boundSql = mappedStatement.getBoundSql(parameter);</span><br><span class=\"line\">            Configuration configuration = mappedStatement.getConfiguration();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                result = invocation.proceed();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">long</span> endTime = System.currentTimeMillis();</span><br><span class=\"line\">                <span class=\"keyword\">long</span> sqlCostTime = endTime - startTime;</span><br><span class=\"line\">                String sql = <span class=\"keyword\">this</span>.getSql(configuration, boundSql);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.formatSqlLog(sqlId, sql, sqlCostTime, result);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">plugin</span><span class=\"params\">(Object target)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target <span class=\"keyword\">instanceof</span> Executor) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Plugin.wrap(target, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setProperties</span><span class=\"params\">(Properties properties)</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取完整的sql语句</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> configuration</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boundSql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">getSql</span><span class=\"params\">(Configuration configuration, BoundSql boundSql)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 输入sql字符串空判断</span></span><br><span class=\"line\">        String sql = boundSql.getSql();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.isEmpty(sql)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> formatSql(sql, configuration, boundSql);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将占位符替换成参数值</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> configuration</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> boundSql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">formatSql</span><span class=\"params\">(String sql, Configuration configuration, BoundSql boundSql)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//美化sql</span></span><br><span class=\"line\">        sql = beautifySql(sql);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//填充占位符, 目前基本不用mybatis存储过程调用,故此处不做考虑</span></span><br><span class=\"line\">        Object parameterObject = boundSql.getParameterObject();</span><br><span class=\"line\">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class=\"line\">        TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry();</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;String&gt; parameters = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (parameterMappings != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            MetaObject metaObject = parameterObject == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : configuration.newMetaObject(parameterObject);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; parameterMappings.size(); i++) &#123;</span><br><span class=\"line\">                ParameterMapping parameterMapping = parameterMappings.get(i);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (parameterMapping.getMode() != ParameterMode.OUT) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//  参数值</span></span><br><span class=\"line\">                    Object value;</span><br><span class=\"line\">                    String propertyName = parameterMapping.getProperty();</span><br><span class=\"line\">                    <span class=\"comment\">//  获取参数名称</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 获取参数值</span></span><br><span class=\"line\">                        value = boundSql.getAdditionalParameter(propertyName);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (parameterObject == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        value = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 如果是单个值则直接赋值</span></span><br><span class=\"line\">                        value = parameterObject;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        value = metaObject == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : metaObject.getValue(propertyName);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> Number) &#123;</span><br><span class=\"line\">                        parameters.add(String.valueOf(value));</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        StringBuilder builder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">                        builder.append(<span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> Date) &#123;</span><br><span class=\"line\">                            builder.append(dateTimeFormatter.get().format((Date) value));</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> String) &#123;</span><br><span class=\"line\">                            builder.append(value);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        builder.append(<span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">                        parameters.add(builder.toString());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String value : parameters) &#123;</span><br><span class=\"line\">            sql = sql.replaceFirst(<span class=\"string\">&quot;\\\\?&quot;</span>, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 格式化sql日志</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sqlId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> costTime</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">formatSqlLog</span><span class=\"params\">(String sqlId, String sql, <span class=\"keyword\">long</span> costTime, Object obj)</span> </span>&#123;</span><br><span class=\"line\">        String sqlLog = <span class=\"string\">&quot;==&gt; &quot;</span> + sql;</span><br><span class=\"line\">        StringBuffer result = <span class=\"keyword\">new</span> StringBuffer();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> List) &#123;</span><br><span class=\"line\">            List list = (List) obj;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> count = list.size();</span><br><span class=\"line\">            result.append(<span class=\"string\">&quot;&lt;==      Total: &quot;</span> + count);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> Integer) &#123;</span><br><span class=\"line\">            result.append(<span class=\"string\">&quot;&lt;==      Total: &quot;</span> + obj);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        result.append(<span class=\"string\">&quot;      Spend Time ==&gt; &quot;</span> + costTime + <span class=\"string\">&quot; ms&quot;</span>);</span><br><span class=\"line\">        Logger log = LoggerFactory.getLogger(sqlId);</span><br><span class=\"line\">        log.info(sqlLog);</span><br><span class=\"line\">        log.info(result.toString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">beautifySql</span><span class=\"params\">(String sql)</span> </span>&#123;</span><br><span class=\"line\">        sql = sql.replaceAll(<span class=\"string\">&quot;[\\\\s\\n ]+&quot;</span>, <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\">参考<a title=\"#参考\" href=\"#参考\"></a></h2>\n<p><a href=\"https://blog.csdn.net/u010469514/article/details/86550816\" target=\"_blank\">Mybatis打印替换占位符后的完整Sql</a></p>\n","prev":{"title":"CAS实现原理","link":"2018/10/13/CAS实现原理"},"next":{"title":"IO相关知识","link":"2018/09/05/IO相关知识"},"plink":"https://zinki.github.io/2018/09/20/自定义SQL打印/","toc":[{"id":"参考","title":"参考","index":"1"}]}